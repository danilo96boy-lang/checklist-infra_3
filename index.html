<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>INFRA CHECKLIST | Enterprise Edition</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
    
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace'],
                    },
                    colors: {
                        brand: {
                            50: '#eff6ff', 100: '#dbeafe', 500: '#3b82f6', 600: '#2563eb', 700: '#1d4ed8', 800: '#1e40af', 900: '#1e3a8a'
                        }
                    }
                }
            }
        }
    </script>

    <style>
        body { -webkit-print-color-adjust: exact; }
        .fade-in { animation: fadeIn 0.4s cubic-bezier(0.16, 1, 0.3, 1); }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        /* Custom Scrollbar for cleaner look */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
        .dark ::-webkit-scrollbar-thumb { background: #334155; }

        @media print {
            @page { margin: 0; size: auto; }
            body, html { background-color: white !important; color: black !important; height: auto; overflow: visible; }
            body * { visibility: hidden; }
            #receipt-area, #receipt-area * { visibility: visible; }
            #receipt-area { position: absolute; left: 0; top: 0; width: 100%; margin: 0; padding: 20px; z-index: 9999; }
            .no-print { display: none !important; }
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 dark:bg-slate-950 dark:text-slate-200 antialiased font-sans transition-colors duration-300">
    <div id="root"></div>

    <script type="text/babel">
        // --- CONFIGURAÇÃO FIREBASE (MANTIDA) ---
        const firebaseConfig = {
            apiKey: "AIzaSyC10F9wJuw36E0zz00ou2-t2-7TXtEjUl8",
            authDomain: "checklist-infra.firebaseapp.com",
            projectId: "checklist-infra",
            storageBucket: "checklist-infra.firebasestorage.app",
            messagingSenderId: "456261856462",
            appId: "1:456261856462:web:f90da7a62c8a08d072349f"
        };

        if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const { useState, useEffect, useRef } = React;

        // --- CONFIGURAÇÃO DO LOGO FIXO ---
        // SUBSTITUA O CÓDIGO ABAIXO PELO BASE64 DO SEU LOGO.
        // Exemplo atual: Um ícone de escudo azul.
        const COMPANY_LOGO = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAfQAAADTCAYAAAB3COGwAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMTQ1IDc5LjE2MzQ5OSwgMjAxOC8wOC8xMy0xNjo0MDoyMiAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTkgKFdpbmRvd3MpIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjVENDg4QkZDNjhBOTExRUFBQjkzRkE2QTc3RUMzNDEzIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjVENDg4QkZENjhBOTExRUFBQjkzRkE2QTc3RUMzNDEzIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6NUQ0ODhCRkE2OEE5MTFFQUFCOTNGQTZBNzdFQzM0MTMiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6NUQ0ODhCRkI2OEE5MTFFQUFCOTNGQTZBNzdFQzM0MTMiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz42W6C7AAAhzUlEQVR42uyd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;

        // --- DADOS ESTÁTICOS ---
        const EMAIL_DESTINO = "infra@cobrecom.com.br";
        const DEFAULT_TEAM = [
            { id: '01001071', name: 'Inacio', pass: '1234' },
            { id: '01001440', name: 'Kauan', pass: '1234' },
            { id: '01001691', name: 'Lui', pass: '1234' }
        ];

        // --- ICONS (Lucide Style) ---
        const Icons = {
            Layout: <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="18" height="18" x="3" y="3" rx="2" ry="2"/><line x1="3" x2="21" y1="9" y2="9"/><line x1="9" x2="9" y1="21" y2="9"/></svg>,
            User: <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>,
            History: <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 3v5h5"/><path d="M3.05 13A9 9 0 1 0 6 5.3L3 8"/></svg>,
            Plus: <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>,
            LogOut: <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>,
            Settings: <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>,
            Check: <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M20 6 9 17l-5-5"/></svg>,
            Printer: <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="6 9 6 2 18 2 18 9"/><path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"/><rect width="12" height="8" x="6" y="14"/></svg>,
            Search: <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>,
            Moon: <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg>,
            Sun: <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="5"/><path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/></svg>,
            Trash: <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>,
            Server: <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="20" height="8" x="2" y="2" rx="2" ry="2"/><rect width="20" height="8" x="2" y="14" rx="2" ry="2"/><line x1="6" x2="6.01" y1="6" y2="6"/><line x1="6" x2="6.01" y1="18" y2="18"/></svg>,
            Mail: <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><polyline points="22,6 12,13 2,6"></polyline></svg>,
            ChevronLeft: <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m15 18-6-6 6-6"/></svg>
        };

        // --- TEMPLATES ---
        const getTemplate = (type, tecnicoName) => {
            const tmpl = {
                meta: { tecnico: tecnicoName || '', data: new Date().toISOString().split('T')[0], maquina: '', ativo: '' },
                items: {}
            };
            if (type === 'formatacao') {
                tmpl.items = {
                    preventivas: { title: "Preventivas", icon: "Server", tasks: [{ id: 'f_prev_1', label: 'Limpeza interna', checked: false }, { id: 'f_prev_2', label: 'Pasta térmica', checked: false }, { id: 'f_prev_3', label: 'Limpeza memórias', checked: false }, { id: 'f_prev_4', label: 'Limpa contato', checked: false }] },
                    preparacao: { title: "Backup & Prep", icon: "Server", tasks: [{ id: 'f_prep_1', label: 'Verif. Nome/Partições', checked: false }, { id: 'f_prep_2', label: 'Backup Arquivos', checked: false }, { id: 'f_prep_3', label: 'Chave Office', checked: false }, { id: 'f_prep_4', label: 'Backup Navegador', checked: false }, { id: 'f_prep_5', label: 'Backup Outlook/Spark', checked: false }] },
                    sistema: { title: "Sistema Operacional", icon: "Server", tasks: [{ id: 'f_sis_1', label: 'Formatação', checked: false }, { id: 'f_sis_2', label: 'Domínio', checked: false }, { id: 'f_sis_3', label: 'Proxy/DNS', checked: false }, { id: 'f_sis_4', label: 'WINS/Hosts', checked: false }, { id: 'f_sis_5', label: 'Drivers', checked: false }] },
                    seguranca: { title: "Segurança", icon: "Server", tasks: [{ id: 'f_sec_1', label: 'Wazuh', checked: false }, { id: 'f_sec_2', label: 'ESET', checked: false }, { id: 'f_sec_3', label: 'VNC + Firewall', checked: false }, { id: 'f_sec_4', label: 'GPEDIT/Permissões', checked: false }] },
                    configuracao: { title: "Configurações", icon: "Server", tasks: [{ id: 'f_conf_1', label: 'Ativar Win/Office', checked: false }, { id: 'f_conf_2', label: 'Energia', checked: false }, { id: 'f_conf_3', label: 'Config. Email', checked: false }, { id: 'f_conf_4', label: 'Config. Spark', checked: false }, { id: 'f_conf_5', label: 'Impressoras', checked: false }, { id: 'f_conf_6', label: 'Map. Rede', checked: false }, { id: 'f_conf_7', label: 'IP Fixo (MAC)', checked: false } ]},
                    apps: { title: "Aplicações", icon: "Server", tasks: [{ id: 'f_app_1', label: 'TOTVS', checked: false }, { id: 'f_app_2', label: 'TOTVS-MES', checked: false }] },
                    finalizacao: { title: "Entrega", icon: "Server", tasks: [{ id: 'f_fin_1', label: 'Restore Navegador', checked: false }, { id: 'f_fin_2', label: 'Restore Email', checked: false }, { id: 'f_fin_3', label: 'Etiqueta Ativo', checked: false }, { id: 'f_fin_4', label: 'Desempenho', checked: false }] }
                };
            } else {
                tmpl.items = {
                    inspecao: { title: "Inspeção Física", icon: "Check", tasks: [{ id: 'z_insp_1', label: 'Rolete', checked: false }, { id: 'z_insp_2', label: 'Cabeça Impressão', checked: false }, { id: 'z_insp_3', label: 'Suporte Etiqueta', checked: false }, { id: 'z_insp_4', label: 'Qualidade Inicial', checked: false }] },
                    preventiva: { title: "Manutenção", icon: "Server", tasks: [{ id: 'z_prev_1', label: 'Limpeza Rolete', checked: false }, { id: 'z_prev_2', label: 'Limpeza Cabeça', checked: false }, { id: 'z_prev_3', label: 'Limpeza Suporte', checked: false }, { id: 'z_prev_4', label: 'Limpeza Geral', checked: false }] },
                    teste: { title: "Validação", icon: "Printer", tasks: [{ id: 'z_test_1', label: 'Teste Final', checked: false }] }
                };
            }
            return tmpl;
        };

        // --- COMPONENTES UI (DESIGN SYSTEM) ---
        const Button = ({ children, variant = 'primary', className = "", ...props }) => {
            const variants = {
                primary: 'bg-brand-600 hover:bg-brand-700 text-white shadow-sm hover:shadow border border-transparent',
                secondary: 'bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-200 border border-slate-200 dark:border-slate-700 hover:bg-slate-50 dark:hover:bg-slate-700',
                danger: 'bg-red-50 text-red-600 border border-red-200 hover:bg-red-100 dark:bg-red-900/20 dark:border-red-900/40 dark:text-red-400',
                ghost: 'bg-transparent text-slate-500 hover:text-slate-700 dark:hover:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-800'
            };
            return <button {...props} className={`px-4 py-2 rounded-lg text-sm font-medium transition-all duration-200 flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed ${variants[variant]} ${className}`}>{children}</button>;
        };

        const Card = ({ children, className = "", noPadding = false, ...props }) => (
            <div {...props} className={`bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800 rounded-xl shadow-sm ${noPadding ? '' : 'p-6'} ${className}`}>{children}</div>
        );

        const Input = (props) => <input {...props} className={`w-full h-10 px-3 bg-white dark:bg-slate-950 border border-slate-300 dark:border-slate-700 rounded-lg text-sm text-slate-800 dark:text-slate-100 placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-brand-500/20 focus:border-brand-500 transition-all ${props.className}`} />;

        const Badge = ({ children, color = 'slate' }) => {
            const colors = {
                slate: 'bg-slate-100 text-slate-600 dark:bg-slate-800 dark:text-slate-400',
                blue: 'bg-blue-50 text-blue-700 dark:bg-blue-900/30 dark:text-blue-300',
                green: 'bg-emerald-50 text-emerald-700 dark:bg-emerald-900/30 dark:text-emerald-300',
                amber: 'bg-amber-50 text-amber-700 dark:bg-amber-900/30 dark:text-amber-300'
            };
            return <span className={`px-2 py-1 rounded text-[10px] uppercase font-bold tracking-wider ${colors[color]}`}>{children}</span>
        };

        // --- TELAS ---

        const LoginScreen = ({ onLogin, users }) => {
            const [id, setId] = useState('');
            const [pass, setPass] = useState('');
            const [error, setError] = useState('');

            const handleSubmit = (e) => {
                e.preventDefault();
                const user = users.find(u => u.id === id && u.pass === pass);
                if (user) onLogin(user); else setError('Credenciais inválidas.');
            };

            return (
                <div className="min-h-screen flex items-center justify-center bg-slate-100 dark:bg-slate-950 p-4">
                    <div className="w-full max-w-md bg-white dark:bg-slate-900 rounded-2xl shadow-xl border border-slate-200 dark:border-slate-800 overflow-hidden fade-in">
                        <div className="p-8 pb-6 text-center border-b border-slate-100 dark:border-slate-800">
                            <img src={COMPANY_LOGO} alt="Logo" className="h-16 w-auto mx-auto mb-4" />
                            <h1 className="text-xl font-bold text-slate-900 dark:text-white">Infra Checklist</h1>
                            <p className="text-sm text-slate-500 mt-1">Acesso Administrativo</p>
                        </div>
                        <form onSubmit={handleSubmit} className="p-8 space-y-4">
                            <div>
                                <label className="block text-xs font-semibold text-slate-500 uppercase mb-1.5 ml-1">ID Usuário</label>
                                <Input value={id} onChange={e => setId(e.target.value)} placeholder="000000" autoFocus />
                            </div>
                            <div>
                                <label className="block text-xs font-semibold text-slate-500 uppercase mb-1.5 ml-1">Senha</label>
                                <Input type="password" value={pass} onChange={e => setPass(e.target.value)} placeholder="••••" />
                            </div>
                            {error && <div className="text-red-500 text-xs font-medium text-center bg-red-50 dark:bg-red-900/20 py-2 rounded-lg">{error}</div>}
                            <Button type="submit" className="w-full h-11 text-base mt-2">Acessar Sistema</Button>
                        </form>
                        <div className="bg-slate-50 dark:bg-slate-950/50 p-4 text-center border-t border-slate-100 dark:border-slate-800">
                            <p className="text-[10px] text-slate-400">V2.2 ENTERPRISE • COBRECOM TI</p>
                        </div>
                    </div>
                </div>
            );
        };

        const ConfigModal = ({ onClose, users }) => {
            const [newUser, setNewUser] = useState({ id: '', name: '', pass: '' });
            
            const handleAddUser = (e) => {
                e.preventDefault();
                if(!newUser.id || !newUser.name || !newUser.pass) return alert("Preencha todos os campos.");
                if(users.some(u => u.id === newUser.id)) return alert("ID já cadastrado.");
                db.collection('users').add(newUser).then(() => { alert("Usuário adicionado."); setNewUser({ id: '', name: '', pass: '' }); });
            };

            const handleDeleteUser = (docId) => { if(confirm("Remover usuário?")) db.collection('users').doc(docId).delete(); };

            return (
                <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/40 backdrop-blur-sm fade-in">
                    <Card className="w-full max-w-2xl max-h-[85vh] flex flex-col overflow-hidden" noPadding>
                        <div className="p-4 border-b border-slate-100 dark:border-slate-800 flex justify-between items-center bg-slate-50 dark:bg-slate-800/50">
                            <h2 className="font-bold flex items-center gap-2 text-slate-700 dark:text-slate-200">{Icons.Settings} Configurações de Equipe</h2>
                            <button onClick={onClose} className="text-2xl leading-none text-slate-400 hover:text-slate-600">&times;</button>
                        </div>
                        <div className="p-6 overflow-y-auto grid md:grid-cols-2 gap-8">
                            <div>
                                <h3 className="text-xs font-bold uppercase text-slate-500 mb-4 tracking-wider">Adicionar Membro</h3>
                                <form onSubmit={handleAddUser} className="space-y-3">
                                    <Input placeholder="ID (Matrícula)" value={newUser.id} onChange={e => setNewUser({...newUser, id: e.target.value})} />
                                    <Input placeholder="Nome Completo" value={newUser.name} onChange={e => setNewUser({...newUser, name: e.target.value})} />
                                    <Input type="password" placeholder="Senha de Acesso" value={newUser.pass} onChange={e => setNewUser({...newUser, pass: e.target.value})} />
                                    <Button type="submit" className="w-full">{Icons.Plus} Cadastrar</Button>
                                </form>
                            </div>
                            <div>
                                <h3 className="text-xs font-bold uppercase text-slate-500 mb-4 tracking-wider">Membros Ativos</h3>
                                <div className="space-y-2 max-h-[300px] overflow-y-auto pr-2">
                                    {users.map(u => (
                                        <div key={u.id} className="flex justify-between items-center p-3 bg-slate-50 dark:bg-slate-800 rounded border border-slate-200 dark:border-slate-700">
                                            <div>
                                                <div className="font-semibold text-sm text-slate-700 dark:text-slate-200">{u.name}</div>
                                                <div className="text-[10px] text-slate-400 font-mono">{u.id}</div>
                                            </div>
                                            {u.id !== 'admin' && <button onClick={() => handleDeleteUser(u.docId)} className="text-slate-400 hover:text-red-500 transition-colors">{Icons.Trash}</button>}
                                        </div>
                                    ))}
                                </div>
                            </div>
                        </div>
                    </Card>
                </div>
            );
        };

        const ReceiptView = ({ ticket, onBack, onArchive, currentUser }) => {
            const [obs, setObs] = useState('');
            const meta = ticket.data.meta;
            const identificador = meta.maquina || meta.equipamento || "N/A";
            
            // Cálculos
            let totalTasks = 0, checkedTasks = 0;
            const pendingList = [];
            const categorySummary = Object.values(ticket.data.items).map(group => {
                const total = group.tasks.length;
                const checked = group.tasks.filter(t => t.checked).length;
                group.tasks.forEach(t => { if(!t.checked) pendingList.push(`- [${group.title}] ${t.label}`); });
                totalTasks += total;
                checkedTasks += checked;
                return { title: group.title, status: checked === total ? "OK" : "PENDENTE" };
            });
            const percent = totalTasks === 0 ? 0 : Math.round((checkedTasks / totalTasks) * 100);
            const statusGlobal = percent === 100 ? "CONCLUÍDO" : "PARCIAL";

            const handleSendOutlook = () => {
                const subject = `[${statusGlobal}] Checklist #${ticket.visualId} - ${identificador}`;
                const body = `RELATÓRIO TÉCNICO\n----------------------------------------\nID: #${ticket.visualId}\nATIVO: ${identificador}\nSTATUS: ${statusGlobal}\nTÉCNICO: ${meta.tecnico}\nDATA: ${new Date().toLocaleDateString()}\n----------------------------------------\nRESUMO:\n${categorySummary.map(c => `[${c.status}] ${c.title}`).join('\n')}\n----------------------------------------\nOBSERVAÇÕES:\n${obs || "Sem observações."}\n\nGerado via InfraChecklist`;
                window.location.href = `mailto:${EMAIL_DESTINO}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
                
                // Pequeno delay para UX
                setTimeout(() => {
                    if(confirm("E-mail aberto? Clique OK para arquivar.")) onArchive(ticket);
                }, 1000);
            };

            return (
                <div className="flex flex-col h-full bg-slate-100 dark:bg-slate-950 overflow-auto p-4 md:p-8">
                    <div className="max-w-4xl mx-auto w-full space-y-6 fade-in no-print">
                        <div className="flex items-center justify-between">
                             <div className="flex items-center gap-2 text-slate-500 hover:text-slate-700 cursor-pointer" onClick={onBack}>
                                {Icons.ChevronLeft} <span className="font-bold text-sm">Voltar à Edição</span>
                            </div>
                            <h1 className="text-2xl font-bold text-slate-800 dark:text-white">Revisão & Entrega</h1>
                        </div>

                        <Card className="grid md:grid-cols-2 gap-6">
                            <div className="space-y-4">
                                <div>
                                    <label className="block text-xs font-bold text-slate-500 uppercase mb-2">Observações Finais</label>
                                    <textarea value={obs} onChange={e => setObs(e.target.value)} className="w-full p-3 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg text-sm h-32 resize-none focus:ring-2 focus:ring-brand-500/20 outline-none" placeholder="Detalhes adicionais, peças trocadas, etc..."></textarea>
                                </div>
                            </div>
                            <div className="flex flex-col justify-center gap-3 border-l border-slate-100 dark:border-slate-800 pl-6">
                                <h3 className="text-sm font-bold text-slate-700 dark:text-slate-300">Ações de Encerramento</h3>
                                <Button className="w-full justify-start" onClick={() => window.print()} variant="secondary">{Icons.Printer} Imprimir Relatório</Button>
                                <Button className="w-full justify-start" onClick={handleSendOutlook}>{Icons.Mail} Enviar E-mail & Arquivar</Button>
                            </div>
                        </Card>
                    </div>

                    {/* ÁREA DE IMPRESSÃO (Oculta na tela, visível no print) */}
                    <div id="receipt-area" className="hidden bg-white text-black font-sans text-xs border border-gray-300 p-0">
                         <div className="flex justify-between items-center p-6 border-b-2 border-black">
                            <div className="flex items-center gap-4"><img src={COMPANY_LOGO} className="h-12 object-contain" /><div><h1 className="text-xl font-bold tracking-tighter uppercase">Relatório Técnico</h1><p className="text-[10px] uppercase tracking-widest text-gray-500">Departamento de TI • Infraestrutura</p></div></div>
                            <div className="text-right"><div className="text-2xl font-mono font-bold">#{ticket.visualId || 'PEND'}</div><div className="text-[10px] font-bold">{new Date().toLocaleDateString()}</div></div>
                        </div>
                        <div className="grid grid-cols-4 border-b border-black">
                            <div className="p-3 border-r border-black"><span className="block text-[9px] font-bold uppercase text-gray-500">Ativo</span><span className="font-bold text-sm block truncate">{identificador}</span></div>
                            <div className="p-3 border-r border-black"><span className="block text-[9px] font-bold uppercase text-gray-500">Tipo</span><span className="font-bold uppercase">{ticket.type}</span></div>
                            <div className="p-3 border-r border-black"><span className="block text-[9px] font-bold uppercase text-gray-500">Técnico</span><span className="font-bold uppercase truncate">{meta.tecnico}</span></div>
                            <div className={`p-3 text-center flex flex-col justify-center ${percent === 100 ? 'bg-gray-100' : 'bg-gray-200'}`}><span className="block text-[9px] font-bold uppercase text-gray-500">Status</span><span className="font-bold text-sm">{statusGlobal}</span></div>
                        </div>
                        <div className="p-6 flex gap-8">
                            <div className="w-1/2"><h3 className="font-bold uppercase text-[10px] mb-2 border-b border-black pb-1">Checklist</h3><table className="w-full text-left border-collapse"><tbody>{categorySummary.map((cat, i) => (<tr key={i} className="border-b border-dotted border-gray-400"><td className="py-1.5 font-medium">{cat.title}</td><td className="py-1.5 text-right font-mono font-bold">{cat.status === 'OK' ? 'OK' : '⚠'}</td></tr>))}</tbody></table></div>
                            <div className="w-1/2 flex flex-col gap-4">
                                {pendingList.length > 0 && (<div className="border border-black p-2 bg-gray-50"><h3 className="font-bold uppercase text-[9px] mb-1">Pendências</h3><ul className="list-disc list-inside text-[10px] space-y-0.5">{pendingList.map((p, i) => <li key={i} className="truncate">{p.replace('- ', '')}</li>)}</ul></div>)}
                                <div><h3 className="font-bold uppercase text-[10px] mb-1 border-b border-black pb-1">Observações</h3><p className="text-[10px] leading-relaxed italic h-16">{obs || "Sem observações adicionais."}</p></div>
                            </div>
                        </div>
                        <div className="mt-8 px-6 pb-6 pt-4 flex justify-between gap-12"><div className="w-1/2 text-center"><div className="border-t border-black pt-1"></div><p className="text-[9px] font-bold uppercase">Técnico Responsável</p></div><div className="w-1/2 text-center"><div className="border-t border-black pt-1"></div><p className="text-[9px] font-bold uppercase">Validado Por</p></div></div>
                    </div>
                </div>
            );
        };

        const ActiveChecklist = ({ ticket, onUpdate, onBack, onRequestFinish }) => {
            if (!ticket) return null;
            const { data } = ticket;

            const handleMeta = (field, value) => { onUpdate({ ...data, meta: { ...data.meta, [field]: value } }); };
            const handleCheck = (section, taskId) => {
                const newData = { ...data };
                const newTasks = newData.items[section].tasks.map(t => t.id === taskId ? { ...t, checked: !t.checked } : t);
                newData.items[section] = { ...newData.items[section], tasks: newTasks };
                onUpdate(newData);
            };

            let total = 0, checked = 0;
            Object.values(data.items).forEach(g => g.tasks.forEach(t => { total++; if(t.checked) checked++; }));
            const progress = total === 0 ? 0 : Math.round((checked/total)*100);

            return (
                <div className="flex flex-col h-full overflow-hidden bg-slate-100 dark:bg-slate-950 relative">
                    {/* Header do Checklist */}
                    <div className="bg-white dark:bg-slate-900 border-b border-slate-200 dark:border-slate-800 p-4 px-6 flex justify-between items-center shadow-sm z-10 shrink-0">
                        <div className="flex items-center gap-4">
                            <button onClick={onBack} className="p-2 -ml-2 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-lg text-slate-500">{Icons.ChevronLeft}</button>
                            <div>
                                <div className="flex items-center gap-2">
                                    <h2 className="text-lg font-bold text-slate-800 dark:text-white leading-none">#{ticket.visualId}</h2>
                                    <Badge color={ticket.type === 'formatacao' ? 'blue' : 'amber'}>{ticket.type}</Badge>
                                </div>
                                <p className="text-xs text-slate-500 mt-1">Criado em {new Date(ticket.createdAt).toLocaleDateString()}</p>
                            </div>
                        </div>
                        <div className="flex items-center gap-4">
                            <div className="text-right hidden sm:block">
                                <span className="text-xs font-bold text-brand-600 block">{progress}% Completo</span>
                                <div className="w-32 h-1.5 bg-slate-100 dark:bg-slate-800 rounded-full mt-1 overflow-hidden"><div className="h-full bg-brand-600 transition-all duration-500" style={{width: `${progress}%`}}></div></div>
                            </div>
                            <Button onClick={onRequestFinish} variant={progress === 100 ? 'primary' : 'secondary'}>{progress === 100 ? 'Finalizar' : 'Revisar'}</Button>
                        </div>
                    </div>

                    {/* Corpo Scrollável */}
                    <div className="flex-1 overflow-y-auto p-4 md:p-6 space-y-6">
                        <Card className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4" noPadding>
                            <div className="p-6 col-span-full border-b border-slate-100 dark:border-slate-800 bg-slate-50/50 dark:bg-slate-800/30">
                                <h3 className="text-xs font-bold uppercase text-slate-500 tracking-wider">Dados do Equipamento</h3>
                            </div>
                            <div className="p-6 pt-2 col-span-full grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                                {Object.keys(data.meta).map(field => (
                                    <div key={field}>
                                        <label className="block text-[10px] font-bold text-slate-400 uppercase mb-1.5 tracking-wider">{field}</label>
                                        <Input type={field === 'data' ? 'date' : 'text'} value={data.meta[field]} onChange={e => handleMeta(field, e.target.value)} />
                                    </div>
                                ))}
                            </div>
                        </Card>

                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4 pb-12">
                            {Object.entries(data.items).map(([key, group]) => (
                                <Card key={key} noPadding className="overflow-hidden h-fit">
                                    <div className="px-4 py-3 border-b border-slate-100 dark:border-slate-800 bg-slate-50 dark:bg-slate-800/50 flex items-center gap-2">
                                        <div className="text-brand-500">{Icons[group.icon]}</div>
                                        <h3 className="font-bold text-slate-700 dark:text-slate-200 text-xs uppercase tracking-wider">{group.title}</h3>
                                    </div>
                                    <div className="divide-y divide-slate-50 dark:divide-slate-800/50">
                                        {group.tasks.map(task => (
                                            <label key={task.id} className="flex items-start gap-3 p-3 px-4 hover:bg-slate-50 dark:hover:bg-slate-800 cursor-pointer group transition-colors select-none">
                                                <div className={`mt-0.5 w-5 h-5 rounded border flex items-center justify-center transition-all duration-200 ${task.checked ? 'bg-brand-600 border-brand-600' : 'border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-800'}`}>
                                                    {task.checked && <svg className="w-3.5 h-3.5 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth="3"><path d="M5 13l4 4L19 7" /></svg>}
                                                </div>
                                                <input type="checkbox" checked={task.checked} onChange={() => handleCheck(key, task.id)} className="hidden" />
                                                <span className={`text-sm font-medium ${task.checked ? 'text-slate-400 line-through' : 'text-slate-700 dark:text-slate-300'}`}>{task.label}</span>
                                            </label>
                                        ))}
                                    </div>
                                </Card>
                            ))}
                        </div>
                    </div>
                </div>
            );
        };

        const Dashboard = ({ activeTickets, onNewTicket, onOpenTicket, onDeleteTicket, historyCount }) => {
            const formatCount = activeTickets.filter(t => t.type === 'formatacao').length;
            const zebraCount = activeTickets.filter(t => t.type !== 'formatacao').length;

            return (
                <div className="p-6 md:p-10 space-y-8 fade-in">
                    <div>
                        <h2 className="text-2xl font-bold text-slate-900 dark:text-white tracking-tight">Visão Geral</h2>
                        <p className="text-slate-500 text-sm">Monitoramento de atividades de infraestrutura em tempo real.</p>
                    </div>
                    
                    {/* KPI CARDS */}
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <Card className="flex items-center justify-between p-5 border-l-4 border-l-brand-500">
                            <div><p className="text-slate-500 text-xs uppercase font-bold tracking-wider">Chamados Abertos</p><h3 className="text-3xl font-bold text-slate-800 dark:text-white mt-1">{activeTickets.length}</h3></div>
                            <div className="bg-brand-50 dark:bg-brand-900/20 p-3 rounded-xl text-brand-600">{Icons.Layout}</div>
                        </Card>
                         <Card className="flex items-center justify-between p-5 border-l-4 border-l-emerald-500">
                            <div><p className="text-slate-500 text-xs uppercase font-bold tracking-wider">Histórico Total</p><h3 className="text-3xl font-bold text-slate-800 dark:text-white mt-1">{historyCount}</h3></div>
                            <div className="bg-emerald-50 dark:bg-emerald-900/20 p-3 rounded-xl text-emerald-600">{Icons.History}</div>
                        </Card>
                        <Card className="flex items-center justify-between p-5 border-l-4 border-l-indigo-500">
                            <div><p className="text-slate-500 text-xs uppercase font-bold tracking-wider">Formatações</p><h3 className="text-3xl font-bold text-slate-800 dark:text-white mt-1">{formatCount}</h3></div>
                            <div className="bg-indigo-50 dark:bg-indigo-900/20 p-3 rounded-xl text-indigo-600">{Icons.Server}</div>
                        </Card>
                    </div>

                    {/* ACTION BAR */}
                    <div className="flex flex-col md:flex-row gap-4">
                        <button onClick={() => onNewTicket('formatacao')} className="flex-1 bg-gradient-to-r from-brand-600 to-brand-700 hover:from-brand-500 hover:to-brand-600 text-white p-4 rounded-xl shadow-lg shadow-brand-500/20 transition-all flex items-center justify-between group">
                            <div className="flex items-center gap-4">
                                <div className="p-2 bg-white/20 rounded-lg backdrop-blur-sm">{Icons.Plus}</div>
                                <div className="text-left"><span className="block font-bold">Nova Formatação</span><span className="text-xs opacity-80">Checklist completo de P.C.</span></div>
                            </div>
                        </button>
                        <button onClick={() => onNewTicket('zebra')} className="flex-1 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 hover:border-brand-500 p-4 rounded-xl shadow-sm hover:shadow-md transition-all flex items-center justify-between group">
                            <div className="flex items-center gap-4">
                                <div className="p-2 bg-slate-100 dark:bg-slate-700 rounded-lg text-slate-600 dark:text-slate-300 group-hover:text-brand-500">{Icons.Printer}</div>
                                <div className="text-left"><span className="block font-bold text-slate-700 dark:text-slate-200">Manutenção Zebra</span><span className="text-xs text-slate-500">Impressoras térmicas</span></div>
                            </div>
                        </button>
                    </div>

                    {/* ACTIVE TICKETS */}
                    <div>
                        <h3 className="text-lg font-bold text-slate-800 dark:text-white mb-4 flex items-center gap-2">{Icons.Server} Fila de Atendimento</h3>
                        {activeTickets.length === 0 ? (
                            <div className="border-2 border-dashed border-slate-300 dark:border-slate-800 rounded-xl p-12 text-center">
                                <p className="text-slate-400 font-medium">Nenhum chamado ativo no momento.</p>
                                <p className="text-xs text-slate-500 mt-1">Inicie um novo atendimento acima.</p>
                            </div>
                        ) : (
                            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                {activeTickets.map(ticket => {
                                    let total = 0, checked = 0;
                                    Object.values(ticket.data.items).forEach(g => g.tasks.forEach(t => { total++; if(t.checked) checked++; }));
                                    const pct = total === 0 ? 0 : Math.round((checked/total)*100);
                                    
                                    return (
                                        <div key={ticket.id} onClick={() => onOpenTicket(ticket.id)} className="group bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800 rounded-xl p-5 hover:shadow-lg hover:border-brand-400 dark:hover:border-brand-500 transition-all cursor-pointer relative overflow-hidden">
                                            <div className="absolute top-0 left-0 w-1 h-full bg-brand-500 opacity-0 group-hover:opacity-100 transition-opacity"></div>
                                            <div className="flex justify-between items-start mb-3">
                                                <Badge color={ticket.type === 'formatacao' ? 'blue' : 'amber'}>{ticket.type}</Badge>
                                                <span className="text-xs font-mono font-bold text-slate-400">#{ticket.visualId}</span>
                                            </div>
                                            <h4 className="font-bold text-slate-800 dark:text-white text-lg truncate mb-1">{ticket.data.meta.maquina || "Sem Identificação"}</h4>
                                            <p className="text-xs text-slate-500 mb-4 flex items-center gap-1">{Icons.User} {ticket.data.meta.tecnico}</p>
                                            
                                            <div className="flex items-center gap-3">
                                                <div className="flex-1 h-1.5 bg-slate-100 dark:bg-slate-800 rounded-full overflow-hidden">
                                                    <div className="h-full bg-brand-500" style={{width: `${pct}%`}}></div>
                                                </div>
                                                <span className="text-xs font-bold text-brand-600">{pct}%</span>
                                            </div>
                                            <button onClick={(e) => onDeleteTicket(e, ticket.id)} className="absolute top-4 right-4 p-1 text-slate-300 hover:text-red-500 hover:bg-red-50 rounded transition-colors opacity-0 group-hover:opacity-100">{Icons.Trash}</button>
                                        </div>
                                    );
                                })}
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        const HistoryView = ({ history }) => {
            const [search, setSearch] = useState('');
            const filtered = history.filter(h => 
                h.ativo.toLowerCase().includes(search.toLowerCase()) || 
                h.tecnico.toLowerCase().includes(search.toLowerCase()) || 
                (h.visualId && h.visualId.toLowerCase().includes(search.toLowerCase()))
            );

            return (
                <div className="p-6 md:p-10 h-full flex flex-col fade-in">
                    <div className="flex justify-between items-end mb-6">
                        <div>
                            <h2 className="text-2xl font-bold text-slate-900 dark:text-white">Histórico de Atendimentos</h2>
                            <p className="text-slate-500 text-sm">Registro auditável de todas as manutenções.</p>
                        </div>
                        <div className="relative">
                            <div className="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none text-slate-400">{Icons.Search}</div>
                            <Input placeholder="Buscar por ID, Ativo..." value={search} onChange={e => setSearch(e.target.value)} className="pl-10 w-64" />
                        </div>
                    </div>
                    
                    <Card className="flex-1 overflow-hidden flex flex-col" noPadding>
                        <div className="overflow-auto flex-1">
                            <table className="w-full text-sm text-left">
                                <thead className="bg-slate-50 dark:bg-slate-800 text-xs font-bold text-slate-500 uppercase sticky top-0 z-10 border-b border-slate-200 dark:border-slate-700">
                                    <tr>
                                        <th className="px-6 py-3">ID</th>
                                        <th className="px-6 py-3">Data</th>
                                        <th className="px-6 py-3">Tipo</th>
                                        <th className="px-6 py-3">Ativo</th>
                                        <th className="px-6 py-3">Técnico</th>
                                        <th className="px-6 py-3 text-right">Status</th>
                                    </tr>
                                </thead>
                                <tbody className="divide-y divide-slate-100 dark:divide-slate-800">
                                    {filtered.map((h, i) => (
                                        <tr key={i} className="hover:bg-slate-50 dark:hover:bg-slate-800/50 transition-colors">
                                            <td className="px-6 py-3 font-mono text-xs font-bold text-slate-500">#{h.visualId}</td>
                                            <td className="px-6 py-3 text-slate-600 dark:text-slate-400">{new Date(h.date).toLocaleDateString()}</td>
                                            <td className="px-6 py-3"><Badge color={h.type === 'formatacao' ? 'blue' : 'amber'}>{h.type}</Badge></td>
                                            <td className="px-6 py-3 font-medium text-slate-800 dark:text-white">{h.ativo}</td>
                                            <td className="px-6 py-3 text-slate-600 dark:text-slate-400">{h.tecnico}</td>
                                            <td className="px-6 py-3 text-right"><span className="text-emerald-600 dark:text-emerald-400 text-xs font-bold bg-emerald-50 dark:bg-emerald-900/20 px-2 py-0.5 rounded-full">Concluído</span></td>
                                        </tr>
                                    ))}
                                    {filtered.length === 0 && <tr><td colSpan="6" className="text-center py-8 text-slate-400">Nenhum registro encontrado.</td></tr>}
                                </tbody>
                            </table>
                        </div>
                    </Card>
                </div>
            );
        };

        const App = () => {
            const [view, setView] = useState('login');
            const [currentUser, setCurrentUser] = useState(null);
            const [users, setUsers] = useState([]);
            const [activeTickets, setActiveTickets] = useState([]);
            const [history, setHistory] = useState([]);
            const [currentTicketId, setCurrentTicketId] = useState(null);
            const [darkMode, setDarkMode] = useState(true);
            const [showConfig, setShowConfig] = useState(false);

            // Efeitos e Lógica (MANTIDO DO ORIGINAL, SÓ UI ALTERADA)
            useEffect(() => {
                const savedTheme = localStorage.getItem('sa_theme'); 
                if (savedTheme !== null) setDarkMode(JSON.parse(savedTheme));
                
                const savedUser = localStorage.getItem('sa_user_session'); if (savedUser) { setCurrentUser(JSON.parse(savedUser)); setView('dashboard'); }

                const unsubTickets = db.collection('tickets').onSnapshot(snap => setActiveTickets(snap.docs.map(doc => ({ id: doc.id, ...doc.data() })).sort((a,b) => new Date(b.createdAt) - new Date(a.createdAt))));
                const unsubHistory = db.collection('history').orderBy('date', 'desc').limit(50).onSnapshot(snap => setHistory(snap.docs.map(doc => ({ id: doc.id, ...doc.data() }))));
                const unsubUsers = db.collection('users').onSnapshot(snap => {
                    if (snap.empty) db.collection('users').add({ id: 'admin', name: 'Admin', pass: 'admin' });
                    else setUsers(snap.docs.map(doc => ({ docId: doc.id, ...doc.data() })));
                });
                return () => { unsubTickets(); unsubHistory(); unsubUsers(); };
            }, []);

            useEffect(() => { 
                if (darkMode) document.documentElement.classList.add('dark'); 
                else document.documentElement.classList.remove('dark'); 
                localStorage.setItem('sa_theme', JSON.stringify(darkMode)); 
            }, [darkMode]);

            const handleLogin = (user) => { setCurrentUser(user); localStorage.setItem('sa_user_session', JSON.stringify(user)); setView('dashboard'); };
            const handleLogout = () => { setCurrentUser(null); localStorage.removeItem('sa_user_session'); setView('login'); };
            
            const handleCreateTicket = async (type) => {
                const prefix = type === 'formatacao' ? 'F' : 'Z';
                const counterRef = db.collection('counters').doc(type);
                try {
                    await db.runTransaction(async (t) => {
                        const doc = await t.get(counterRef);
                        const nextSeq = doc.exists ? doc.data().current + 1 : 1001;
                        t.set(counterRef, { current: nextSeq }, { merge: true });
                        const newRef = db.collection('tickets').doc();
                        t.set(newRef, { visualId: `${prefix}-${nextSeq}`, type, data: getTemplate(type, currentUser.name), createdAt: new Date().toISOString() });
                        setCurrentTicketId(newRef.id);
                        setView('checklist');
                    });
                } catch (e) { alert("Erro de conexão."); }
            };

            const handleUpdateTicket = (newData) => { if (currentTicketId) db.collection('tickets').doc(currentTicketId).update({ data: newData }); };
            
            const handleArchive = (ticket) => {
                if(!ticket) return;
                db.collection('history').add({ 
                    visualId: ticket.visualId, type: ticket.type, date: new Date().toISOString(), 
                    tecnico: ticket.data.meta.tecnico, ativo: ticket.data.meta.maquina || "N/A", data: ticket.data 
                }).then(() => db.collection('tickets').doc(ticket.id).delete())
                  .then(() => { setCurrentTicketId(null); setView('dashboard'); });
            };
            
            const handleDeleteActive = (e, id) => { e.stopPropagation(); if(confirm("Cancelar chamado?")) db.collection('tickets').doc(id).delete(); };

            if (view === 'login') return <LoginScreen onLogin={handleLogin} users={users} />;

            return (
                <div className="flex h-screen overflow-hidden bg-slate-100 dark:bg-slate-950 font-sans text-slate-800 dark:text-slate-200">
                    {/* SIDEBAR */}
                    <aside className="w-64 bg-slate-900 text-slate-300 hidden md:flex flex-col border-r border-slate-800 z-20 shrink-0">
                        <div className="h-16 flex items-center gap-3 px-6 font-bold text-white tracking-wide border-b border-slate-800">
                            <img src={COMPANY_LOGO} alt="Logo" className="h-8 w-auto object-contain" />
                            INFRA CHECK
                        </div>
                        <nav className="flex-1 py-6 px-3 space-y-1">
                            <button onClick={() => setView('dashboard')} className={`w-full flex items-center gap-3 px-3 py-2.5 rounded-lg transition-colors font-medium text-sm ${view === 'dashboard' ? 'bg-brand-600 text-white shadow-lg shadow-brand-900/20' : 'hover:bg-slate-800 text-slate-400 hover:text-white'}`}>
                                {Icons.Layout} Dashboard
                            </button>
                            <button onClick={() => setView('history')} className={`w-full flex items-center gap-3 px-3 py-2.5 rounded-lg transition-colors font-medium text-sm ${view === 'history' ? 'bg-brand-600 text-white shadow-lg shadow-brand-900/20' : 'hover:bg-slate-800 text-slate-400 hover:text-white'}`}>
                                {Icons.History} Histórico
                            </button>
                        </nav>
                        <div className="p-4 border-t border-slate-800">
                            <div className="flex items-center gap-3 mb-4 px-2">
                                <div className="w-8 h-8 rounded-full bg-slate-700 flex items-center justify-center text-xs font-bold text-white">
                                    {currentUser.name.charAt(0)}
                                </div>
                                <div className="overflow-hidden">
                                    <p className="text-sm font-bold text-white truncate">{currentUser.name}</p>
                                    <p className="text-xs text-slate-500">Técnico Infra</p>
                                </div>
                            </div>
                            <div className="grid grid-cols-3 gap-2">
                                <button onClick={() => setDarkMode(!darkMode)} className="p-2 rounded bg-slate-800 hover:bg-slate-700 text-slate-400 hover:text-yellow-400 transition-colors flex justify-center">{darkMode ? Icons.Sun : Icons.Moon}</button>
                                <button onClick={() => setShowConfig(true)} className="p-2 rounded bg-slate-800 hover:bg-slate-700 text-slate-400 hover:text-white transition-colors flex justify-center">{Icons.Settings}</button>
                                <button onClick={handleLogout} className="p-2 rounded bg-red-900/20 hover:bg-red-900/40 text-red-400 transition-colors flex justify-center">{Icons.LogOut}</button>
                            </div>
                        </div>
                    </aside>

                    {/* MAIN CONTENT AREA */}
                    <main className="flex-1 flex flex-col min-w-0 bg-slate-100 dark:bg-slate-950">
                        {/* Mobile Header */}
                        <div className="md:hidden h-16 bg-slate-900 text-white flex items-center justify-between px-4 shrink-0">
                            <div className="flex items-center gap-2">
                                <img src={COMPANY_LOGO} alt="Logo" className="h-6 w-auto object-contain" />
                                <span className="font-bold">INFRA CHECK</span>
                            </div>
                            <div className="flex gap-2">
                                <button onClick={() => setView('dashboard')} className="p-2">{Icons.Layout}</button>
                                <button onClick={handleLogout} className="p-2">{Icons.LogOut}</button>
                            </div>
                        </div>

                        {/* Views */}
                        <div className="flex-1 overflow-auto relative">
                            {showConfig && <ConfigModal onClose={() => setShowConfig(false)} users={users} />}
                            {view === 'dashboard' && <Dashboard activeTickets={activeTickets} onNewTicket={handleCreateTicket} onOpenTicket={(id) => { setCurrentTicketId(id); setView('checklist'); }} onDeleteTicket={handleDeleteActive} historyCount={history.length} />}
                            {view === 'checklist' && <ActiveChecklist ticket={activeTickets.find(t => t.id === currentTicketId)} onUpdate={handleUpdateTicket} onBack={() => setView('dashboard')} onRequestFinish={() => setView('receipt')} />}
                            {view === 'receipt' && <ReceiptView ticket={activeTickets.find(t => t.id === currentTicketId)} onBack={() => setView('checklist')} onArchive={handleArchive} currentUser={currentUser} />}
                            {view === 'history' && <HistoryView history={history} />}
                        </div>
                    </main>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
